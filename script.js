/* Columns are a 1-quarter-note grouping.
 *
 * Triplets can be shown by simply having 3 eighth
 * notes per column.
 *
 * Legend
 *   
 *   +  quarter
 *   -  eighth
 *   .  sixtenth
 *   
 *
 * Hyphen:  -
 * En dash: –
 * Em dash: —
 */

tuning = [64, 59, 55, 50, 45, 40];

//tuning = [76, 69, 62, 55];
var tennesseeMountainFoxChaseMandolin = [
  "| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - |",
  "|-3---------------|---------------0-|-5-3-0-----------|-------0-5-3-0---|-----3---|",
  "|-7-----5-3---3-0-|-------0-3---3---|-------5-3---3-0-|-----3---------5-|-3-------|",
  "|-----------------|-5---5-----------|-----------------|-5---------------|---------|",
  "|-----------------|-----------------|-----------------|-----------------|---------|",
  "",
  "| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - |",
  "|-3-3-3-----------|---------------0-|-5-3-0-----------|-------0-5-3-0---|-----0-5-|",
  "|-7-7-7-5-3---3-0-|-------0-3---3---|-------5-3---3-0-|-----3---------5-|-3-------|",
  "|-----------------|-5---5-----------|-----------------|-5---------------|---------|",
  "|-----------------|-----------------|-----------------|-----------------|---------|",
  "",
  "| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - |",
  "|-3---0-5-3---0-5-|-3---0-3-5-3-0-5-|-3---0-5-3---0-3-|-5-3-0-------0-5-|",
  "|-----------------|-----------------|-----------------|-------5-3-------|",
  "|-----------------|-----------------|-----------------|-----------------|",
  "|-----------------|-----------------|-----------------|-----------------|",
  "",
  "| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - |",
  "|-3---0-5-3---0-5-|-3---0-3-5-3-0-5-|-3---0-5-3---0-3-|-5-3-0-----------|",
  "|-----------------|-----------------|-----------------|-------5-3-------|",
  "|-----------------|-----------------|-----------------|-----------------|",
  "|-----------------|-----------------|-----------------|-----------------|",
  "",
  "| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - |",
  "|-----0-3-5---3---|---5-3---3-3-3-3-|-----0-3-5---3---|---5-3-0---------|",
  "|-3-5-------------|---------7-7-7-7-|-3-5-------------|---------3-------|",
  "|-----------------|-----------------|-----------------|-----------------|",
  "|-----------------|-----------------|-----------------|-----------------|",
  "",
  "| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + -|",
  "|-----0-3-5---3---|---5-3---3-3-3-3-|-3-3-3-3-3-3-3-3-|-3-3-3----------|",
  "|-3-5-------------|---------7-7-7-7-|-7-7-7-7-6-7-7-7-|-7-7-5---3------|",
  "|-----------------|-----------------|-----------------|----------------|",
  "|-----------------|-----------------|-----------------|----------------|",
  "",
  "| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - |",
  "|-----0-3-5---3---|---5-3---3-3-3-3-|-----0-3-5---3---|---5-3-0---------|",
  "|-3-5-------------|---------7-7-7-7-|-3-5-------------|---------3-------|",
  "|-----------------|-----------------|-----------------|-----------------|",
  "|-----------------|-----------------|-----------------|-----------------|",
  "",
  "| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + -|",
  "|-----0-3-5---3---|---5-3---3-3-3-3-|-3-3-3-3-3-3-3-3-|-3-3-3----------|",
  "|-3-5-------------|---------7-7-7-7-|-7-7-7-7-6-7-7-7-|-7-7-5---3------|",
  "|-----------------|-----------------|-----------------|----------------|",
  "|-----------------|-----------------|-----------------|----------------|",
].join("\n");


var squirrelHunters = [
  "| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - |",
  "|-0---0-----------|-0-2-0-----------|-----------------|-------------0---|-0---0-----------|-0-2-0-----------|-----------------|-------------0---|-0---0-----------|-0-2-0-----------|-----------------|-------------0---|-0---0-----------|-0-2-0-----------|-----------------|-----------------|",
  "|/5-----3-0---0-3-|-------3-0---0---|-----0-2-3---3-2-|-3-0-2---0---3---|/5-----3-0---0-3-|-------3-0---0---|-----0-2-3-2-0---|-------------3---|/5-----3-0---0-3-|-------3-0---0---|-----0-2-3---3-2-|-3-0-2---0---3---|/5-----3-0---0-3-|-------3-0---0---|-----0-2-3-2-0---|-----2-----2-3-4-|",
  "|-----------------|---------------2-|-0-2-------------|-------2---------|-----------------|---------------2-|-0-2-----------0-|-2---------------|-----------------|---------------2-|-0-2-------------|-------2---------|-----------------|---------------2-|-0-2-----------0-|-2-2---2-2-------|",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
  "",
  "| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - |",
  "|-0---0-3-5---5-3-|-0---0-2-3-------|-----------------|-----------------|-0---0-3-5-7-5-3-|-0---0-2-3-------|-----------------|-----------------|-0---0-3-5---5-3-|-0---0-2-3-------|-----------------|-----------------|-0---0-3-5-7-5-3-|-0---0-2-3-------|-----------------|-----------------|",
  "|/5---------------|---3---------0---|-----0-2-3---3-2-|-3-0-2---0-2-3-4-|---4-------------|---3---------0---|-----0-2-3-2-0---|-------------3-4-|/5---------------|---3---------0---|-----0-2-3---3-2-|-3-0-2---0-2-3-4-|---4-------------|---3---------0---|-----0-2-3-2-0---|-----------------|",
  "|-----------------|---------------2-|-0-2-------------|-------2---------|-----------------|---------------2-|-0-2-----------0-|-2---------------|-----------------|---------------2-|-0-2-------------|-------2---------|-----------------|---------------2-|-0-2-----------0-|-2---------------|",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
].join("\n");

var snowflakeReel = [
  "| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - - + - | + - + - + - + - | + - + - + - + - | + - + - + - - + - | + - + - + - + - |",
  "|-----------------|-----------------|-----------------|-------------------|-----------------|-----------------|-------------------|-----------------|",
  "|-----------------|-----------------|---------------0-|-2---0-2-0-2-0-----|-----------------|-----------------|-------------------|-----------------|",
  "|-------2---------|-----------------|-------------2---|---2-----------2---|-------2---------|-----------------|-------------------|-----------------|",
  "|-0---4---4-2-0-4-|-2-0-----0-------|---------2-4-----|-------------------|-0---4---4-2-0-4-|-2-0-----0-------|-----2-4-4/5/4-2---|-0---0-2-0-------|",
  "|-----------------|-----2-0---2-0---|-0---0-4---------|-------------------|-----------------|-----2-0---2-0---|-0-4-------------4-|---------------2-|",
  "|-----------------|-----------------|-----------------|-------------------|-----------------|-----------------|-------------------|-----------------|",
  "",
  "| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - - + - | + - + - + - + - | + - + - + - + - | + - + - + - - + - | + - + - + - + - |",
  "|-----------------|-----------------|-----------------|-------------------|-----------------|-----------------|-------------------|-----------------|",
  "|-----------------|-----------------|---------------0-|-2---0-2-0-2-0-----|-----------------|-----------------|-------------------|-----------------|",
  "|-------2---------|-----------------|-------------2---|---2-----------2---|-------2---------|-----------------|-------------------|-----------------|",
  "|-0---4---4-2-0-4-|-2-0-----0-------|---------2-4-----|-------------------|-0---4---4-2-0-4-|-2-0-----0-------|-----2-4-4/5/4-2---|-0---0-2-0-------|",
  "|-----------------|-----2-0---2-0---|-0---0-4---------|-------------------|-----------------|-----2-0---2-0---|-0-4-------------4-|---------------2-|",
  "|-----------------|-----------------|-----------------|-------------------|-----------------|-----------------|-------------------|-----------------|",
  "",
  "| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - |",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
  "|-----------------|-2-1-0-----------|-----------------|-3-0---3-0-------|-----------------|-2-1-0-----------|---------0-------|-----------------|",
  "|-----0-4-2-0-----|-------4-3-2-1-0-|---0-3---0-3---0-|-----3-----3-0---|-----0-4-2-0-----|-------4-3-2-1-0-|-------2---2-0---|-0---0-2-0---0---|",
  "|-0-2---------2-0-|-----------------|-1-----1-----1---|---------------3-|-0-2---------2-0-|-----------------|-0-2-4---------4-|---------------2-|",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
  "",
  "| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - |",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
  "|-----------------|-2-1-0-----------|-----------------|-3-0---3-0-------|-----------------|-2-1-0-----------|---------0-------|-----------------|",
  "|-----0-4-2-0-----|-------4-3-2-1-0-|---0-3---0-3---0-|-----3-----3-0---|-----0-4-2-0-----|-------4-3-2-1-0-|-------2---2-0---|-0---0-2-0-------|",
  "|-0-2---------2-0-|-----------------|-1-----1-----1---|---------------3-|-0-2---------2-0-|-----------------|-0-2-4---------4-|-----------------|",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
].join("\n");

var tabString = [
  "|: + - + - + - + - | + - + . - . + - - + - :|",
  "|:-----------------|-----------------------:|",
  "|:-----------------|-----------------------:|",
  "|:-----------------|-0-----------3p2p0-----:|",
  "|:-----------0-2p0-|-------------------2p0-:|",
  "|:-----0-1/2-------|-----------------------:|",
  "|:-3---------------|-----------------------:|",
  "",
  "| + - + - - + - - + - - + - - |",
  "|-----3-1-2-3-----------------|",
  "|-------------2-1-3-1---------|",
  "|-0-------------------3-0---0-|",
  "|-------------------------3---|",
  "|-----------------------------|",
  "|-----------------------------|",
  "",
  "| +  - +  -  +  -  +  -  | +   - + - + - + - |",
  "|------------------------|-------3-2-1-------|",
  "|------------------------|-------------3-2-1-|",
  "|------------------------|<12>---------------|",
  "|---------------12-14p12-|-------------------|",
  "|------12-13/14----------|-------------------|",
  "|-15---------------------|-------------------|",
  "",
  "| + - + - | + - + - |",
  "|---------|---------|",
  "|---------|---------|",
  "|-0-2-3-4-|/5-------|",
  "|---------|---------|",
  "|---------|---------|",
  "|---------|---------|",
].join("\n");

    $('body').keyup(this.goBack);

$(function() {
  //var m = new Measure(4);
  // m.numberOfBars();
  //


  //var mv = new MeasureView(m, $('#measure-prototype'));

  var tp = new TabParser();
  //tab = tp.parse(tabString);
  tab = tp.parse(squirrelHunters);
  //tab = tp.parse(tennesseeMountainFoxChaseMandolin);
  player = new Player;

  tabView = new TabView({
    el: $('#tab'),
    model: tab,
    player: player
  });

  noteSelectorView = new NoteSelectorView({
  });

  playerView = new PlayerView({
    player: player
  });

  cursorView = new CursorView({
    tabView: tabView,
    el: $('body')
  });

  $(document).on('keydown', function(e) {
    console.log(e.keyCode);

    if (e.keyCode == 9) { // \t
      if (e.shiftKey) {
        noteSelectorView.selectPrevNote();
      } else {
        noteSelectorView.selectNextNote();
      }
      e.preventDefault();
    } else if (e.keyCode == 32) { // space
      if (player.player) {
        player.stop();
      } else {
        player.play();
      }
    } else if (e.keyCode == 40) { // down
      cursorView.moveDown();
      e.preventDefault();
    } else if (e.keyCode == 38) { // up
      cursorView.moveUp();
      e.preventDefault();
    } else if (e.keyCode == 39) { // right
      cursorView.moveRight();
      e.preventDefault();
    } else if (e.keyCode == 37) { // left
      cursorView.moveLeft();
      e.preventDefault();
    } else if (e.keyCode == 74) { // j
      cursorView.moveDown();
      e.preventDefault();
    } else if (e.keyCode == 75) { // k
      cursorView.moveUp();
      e.preventDefault();
    } else if (e.keyCode == 76) { // l
      cursorView.moveRight();
      e.preventDefault();
    } else if (e.keyCode == 72) { // h
      cursorView.moveLeft();
      e.preventDefault();
    } else if (e.keyCode >= 48 && e.keyCode <= 57) { // integer
      cursorView.setFret(String.fromCharCode(e.keyCode))
      e.preventDefault();
    }

  });
});


