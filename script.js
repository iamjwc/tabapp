/* Columns are a 1-quarter-note grouping.
 *
 * Triplets can be shown by simply having 3 eighth
 * notes per column.
 *
 * Legend
 *   
 *   +  quarter
 *   -  eighth
 *   .  sixtenth
 *   
 *
 * Hyphen:  -
 * En dash: –
 * Em dash: —
 */

var snowflakeReel = [
  //"| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - - + - | + - + - + - + - | + - + - + - + - | + - + - + - - + - | + - + - + - + - |",
  //"|-----------------|-----------------|-----------------|-------------------|-----------------|-----------------|-------------------|-----------------|",
  //"|-----------------|-----------------|---------------0-|-2---0-2-0-2-0-----|-----------------|-----------------|-------------------|-----------------|",
  //"|-------2---------|-----------------|-------------2---|---2-----------2---|-------2---------|-----------------|-------------------|-----------------|",
  //"|-0---4---4-2-0-4-|-2-0-----0-------|---------2-4-----|-------------------|-0---4---4-2-0-4-|-2-0-----0-------|-----2-4-4/5/4-2---|-0---0-2-0-------|",
  //"|-----------------|-----2-0---2-0---|-0---0-4---------|-------------------|-----------------|-----2-0---2-0---|-0-4-------------4-|---------------2-|",
  //"|-----------------|-----------------|-----------------|-------------------|-----------------|-----------------|-------------------|-----------------|",
  //"",
  //"| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - - + - | + - + - + - + - | + - + - + - + - | + - + - + - - + - | + - + - + - + - |",
  //"|-----------------|-----------------|-----------------|-------------------|-----------------|-----------------|-------------------|-----------------|",
  //"|-----------------|-----------------|---------------0-|-2---0-2-0-2-0-----|-----------------|-----------------|-------------------|-----------------|",
  //"|-------2---------|-----------------|-------------2---|---2-----------2---|-------2---------|-----------------|-------------------|-----------------|",
  //"|-0---4---4-2-0-4-|-2-0-----0-------|---------2-4-----|-------------------|-0---4---4-2-0-4-|-2-0-----0-------|-----2-4-4/5/4-2---|-0---0-2-0-------|",
  //"|-----------------|-----2-0---2-0---|-0---0-4---------|-------------------|-----------------|-----2-0---2-0---|-0-4-------------4-|---------------2-|",
  //"|-----------------|-----------------|-----------------|-------------------|-----------------|-----------------|-------------------|-----------------|",
  //"",
  "| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - |",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
  "|-----------------|-2-1-0-----------|-----------------|-3-0---3-0-------|-----------------|-2-1-0-----------|---------0-------|-----------------|",
  "|-----0-4-2-0-----|-------4-3-2-1-0-|---0-3---0-3---0-|-----3-----3-0---|-----0-4-2-0-----|-------4-3-2-1-0-|-------2---2-0---|-0---0-2-0---0---|",
  "|-0-2---------2-0-|-----------------|-1-----1-----1---|---------------3-|-0-2---------2-0-|-----------------|-0-2-4---------4-|---------------2-|",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
  "",
  "| + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - | + - + - + - + - |",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
  "|-----------------|-2-1-0-----------|-----------------|-3-0---3-0-------|-----------------|-2-1-0-----------|---------0-------|-----------------|",
  "|-----0-4-2-0-----|-------4-3-2-1-0-|---0-3---0-3---0-|-----3-----3-0---|-----0-4-2-0-----|-------4-3-2-1-0-|-------2---2-0---|-0---0-2-0-------|",
  "|-0-2---------2-0-|-----------------|-1-----1-----1---|---------------3-|-0-2---------2-0-|-----------------|-0-2-4---------4-|-----------------|",
  "|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|",
].join("\n");

var tabString = [
  "|: + - + - + - + - | + - + . - . + - - + - :|",
  "|:-----------------|-----------------------:|",
  "|:-----------------|-----------------------:|",
  "|:-----------------|-0-----------3p2p0-----:|",
  "|:-----------0-2p0-|-------------------2p0-:|",
  "|:-----0-1/2-------|-----------------------:|",
  "|:-3---------------|-----------------------:|",
  "",
  "| + - + - - + - - + - - + - - |",
  "|-----3-1-2-3-----------------|",
  "|-------------2-1-3-1---------|",
  "|-0-------------------3-0---0-|",
  "|-------------------------3---|",
  "|-----------------------------|",
  "|-----------------------------|",
  "",
  "| +  - +  -  +  -  +  -  | +   - + - + - + - |",
  "|------------------------|-------3-2-1-------|",
  "|------------------------|-------------3-2-1-|",
  "|------------------------|<12>---------------|",
  "|---------------12-14p12-|-------------------|",
  "|------12-13/14----------|-------------------|",
  "|-15---------------------|-------------------|",
  "",
  "| + - + - | + - + - |",
  "|---------|---------|",
  "|---------|---------|",
  "|-0-2-3-4-|/5-------|",
  "|---------|---------|",
  "|---------|---------|",
  "|---------|---------|",
].join("\n");

    $('body').keyup(this.goBack);

$(function() {
  //var m = new Measure(4);
  // m.numberOfBars();
  //


  //var mv = new MeasureView(m, $('#measure-prototype'));

  var tp = new TabParser();
  //tab = tp.parse(tabString);
  tab = tp.parse(snowflakeReel);
  player = new Player;

  tabView = new TabView({
    el: $('#tab'),
    model: tab,
    player: player
  });

  cursorView = new CursorView({
    tabView: tabView,
    el: $('body')
  });


  $('#start').on('click', function() {
    player.play();
  });

  $('#stop').on('click', function() {
    player.stop();
  });

  $(document).on('keypress', function(e) {
    if (e.keyCode == 9) { // \t
      e.preventDefault();

      cursorView.cursorWidth *= 2
      if (cursorView.cursorWidth >= 12) {
        cursorView.cursorWidth = 3
      }
    } else if (e.keyCode == 106) { // j
      cursorView.moveDown();
    } else if (e.keyCode == 107) { // k
      cursorView.moveUp();
    } else if (e.keyCode == 108) { // l
      cursorView.moveRight();
    } else if (e.keyCode == 104) { // h
      cursorView.moveLeft();
    }

    tabView.render();
  });
});


